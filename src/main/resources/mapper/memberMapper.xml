<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.api.member.mapper.MemberMapper">

    <resultMap id="memberMap" type="com.api.member.domain.Member">
        <id property="id" column="id"/>
        <result property="pass" column="pass"/>
        <result property="name" column="name"/>
        <result property="email" column="mail"/>
        <result property="phone" column="phone"/>
        <result property="mail" column="mail"/>
        <result property="zipcode" column="zipcode"/>
        <result property="address1" column="address1"/>
        <result property="address2" column="address2"/>
        <result property="marketing" column="marketing"/>
        <result property="joinDate" column="joindate"/>
        <result property="modificationDate" column="modificationdate"/>
        <result property="type" column="type"/>
    </resultMap>

    <!-- 회원 정보 조회 -->
    <select id="getMemberInfo" parameterType="String" resultMap="memberMap">
        SELECT 
            id,
            pass,
            name,
            phone,
            mail,
            zipcode,
            address1,
            address2,
            marketing,
            joindate,
            modificationdate,
            type
        FROM member
        WHERE id = #{id}
    </select>

    <!-- 회원 가입 -->
    <insert id="insertMember" parameterType="com.api.member.domain.Member">
        INSERT INTO member (
            id,
            pass,
            name,
            phone,
            mail,
            zipcode,
            address1,
            address2,
            marketing,
            type
        ) VALUES (
            #{id},
            #{pass},
            #{name},
            #{phone},
            #{mail},
            #{zipcode},
            #{address1},
            #{address2},
            #{marketing},
            #{type}
        )
    </insert>

    <!-- 회원 정보 수정 -->
    <update id="updateMember" parameterType="com.api.member.domain.Member">
        UPDATE member
        <set>
            <if test="pass != null and pass != ''">
                pass = #{pass},
            </if>
            <if test="name != null and name != ''">
                name = #{name},
            </if>
            <if test="phone != null and phone != ''">
                phone = #{phone},
            </if>
            <if test="mail != null and mail != ''">
                mail = #{mail},
            </if>
            <if test="zipcode != null">
                zipcode = #{zipcode},
            </if>
            <if test="address1 != null and address1 != ''">
                address1 = #{address1},
            </if>
            <if test="address2 != null and address2 != ''">
                address2 = #{address2},
            </if>
            <if test="marketing != null and marketing != ''">
                marketing = #{marketing},
            </if>
            modificationdate = CURRENT_TIMESTAMP
        </set>
        WHERE id = #{id}
    </update>

    <!-- 회원 삭제 -->
    <delete id="deleteMember" parameterType="String">
        DELETE FROM member
        WHERE id = #{id}
    </delete>

    <!-- 아이디 찾기: 이름과 전화번호로 회원 조회 -->
    <select id="findMemberByNameAndPhone" resultMap="memberMap">
        SELECT 
            id,
            pass,
            name,
            phone,
            mail,
            zipcode,
            address1,
            address2,
            marketing,
            joindate,
            modificationdate,
            type
        FROM member
        WHERE name = #{name} AND phone = #{phone}
    </select>

    <!-- 비밀번호 찾기: 아이디, 이름, 전화번호로 회원 조회 -->
    <select id="findMemberByIdNameAndPhone" resultMap="memberMap">
        SELECT 
            id,
            pass,
            name,
            phone,
            mail,
            zipcode,
            address1,
            address2,
            marketing,
            joindate,
            modificationdate,
            type
        FROM member
        WHERE id = #{id} AND name = #{name} AND phone = #{phone}
    </select>

    <!-- 비밀번호 업데이트 -->
    <update id="updatePassword">
        UPDATE member
        SET pass = #{encodedPassword},
            modificationdate = CURRENT_TIMESTAMP
        WHERE id = #{id}
    </update>

</mapper>

